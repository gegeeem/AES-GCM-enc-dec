<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
  </head>
  <body>
    <div class="container">
      <h1>AES-GCM enkripcija i dekripcija</h1>
      <!-- select  action, encryption or decription -->
      <div class="toggleEncDec">
        <div class="encryptionSlct selected">Enkripcija</div>
        <div class="decryptionSlct">Dekripcija</div>
      </div>
      <!-- encryption -->
      <div class="encryption">
        <form>
          <label for="textForEnc" class="labelTextForEnc"
            >Unesite tekst ispod ili učitajte fajl u .txt formatu</label
          >

          <textarea
            id="textForEnc"
            rows="10"
            placeholder="Unesite tekst"
            required=""
            oninput="handleTextAreaInput(this)"></textarea>
          <div class="getFileAndReset">
            <label for="textForEncFile"
              >Izaberite fajl
              <i class="fas fa-file-upload fa-xl" style="color: #7690bc"></i
            ></label>
            <input
              id="textForEncFile"
              type="file"
              onchange="readFile(this, '#textForEnc')"
              accept=".txt"
              hidden />
            <!-- accept=".txt, .doc, .docx"  -->
            <button onclick="isEmptyOrReset()">Poništi</button>
            <input type="reset" value="ne" />
          </div>
        </form>

        <div class="keyAndIV">
          <label for="userKeyIV"
            ><input
              type="checkbox"
              name="userKeyIV"
              id="userKeyIV"
              class="userKeyIV" />Unesite postojeci tajni kljuc i IV</label
          >
          <div class="displayKeyAndIV hide">
            <div class="secretKey">
              <h6>Unesite tajni kljuc</h6>
              <textarea
                class="keyTxt user"
                cols="30"
                rows="8"
                placeholder="Unesite tajni kljuc"></textarea>
              <input
                type="file"
                class="user"
                onchange="readFile(this,'.keyTxt')" />
            </div>
            <div class="iv">
              <h6>Unesite IV</h6>

              <textarea
                cols="30"
                rows="8"
                class="ivTxtArea user"
                placeholder="Unesite IV"></textarea>
              <input
                type="file"
                class="user"
                onchange="readFile(this,'.ivTxtArea')"
                value="Preuzmite IV" />
            </div>
          </div>
        </div>
        <!-- start encyption btn -->
        <button type="submit" class="startEncryption hide">
          Pokreni Enkripciju
        </button>
        <!-- end of start encryptionbtn -->
        <!-- output encoded txt -->
        <div class="displayEncryptedTxt">
          <textarea id="areaDisplayEncTxt" rows="10"></textarea>
        </div>
        <!-- end of output encoded txt-->
        <!-- start encryption -->

        <!-- <input type="button" class="hajde" value="preuzmi" /> -->
        <!-- end of start ecnryption -->
        <!-- download encrypted txt, secret key & iv -->
        <button class="hajde">Preuzmite kriptovani fajl</button>
        <div>
          <input type="text" class="exportJWK" />
          <button class="btnExportJWK">Preuzmite JWK</button>
          <input type="text" class="exportIV" />
          <button class="btnExportIV">Preuzmite IV</button>
        </div>
      </div>
      <!-- end of encryption -->
      <!-- decryption -->
      <div class="decryption hide">
        <form>
          <label for="textForDec" class="labelTextForEnc"
            >Unesite tekst ispod ili učitajte fajl u .txt formatu</label
          >

          <textarea
            id="textForDec"
            class=""
            rows="10"
            placeholder="Unesite sifrovani tekst"
            required=""
            oninput=""></textarea>
          <div class="getFileAndReset">
            <input
              type="file"
              onchange="readFile(this, '#textForDec')"
              accept=".txt" />
            <!-- accept=".txt, .doc, .docx"  -->
            <button onclick="isEmptyOrReset()">Poništi</button>
            <input type="reset" value="ne" />
          </div>
        </form>

        <div class="keyAndIV">
          <h3>Unesite postojeci tajni kljuc i IV</h3>
          <div class="displayKeyAndIVDec">
            <div class="secretKey">
              <h6>Unesite tajni kljuc</h6>
              <textarea
                class="keyTxtDec user"
                cols="30"
                rows="8"
                placeholder="Unesite tajni kljuc"></textarea>
              <input
                type="file"
                class="user"
                onchange="readFile(this,'.keyTxtDec')" />
            </div>
            <div class="iv">
              <h6>Unesite IV</h6>

              <textarea
                cols="30"
                rows="8"
                class="ivTxtAreaDec user"
                placeholder="Unesite IV"></textarea>
              <input
                type="file"
                class="user"
                onchange="readFile(this,'.ivTxtAreaDec')"
                value="Preuzmite IV" />
            </div>
          </div>
        </div>
        <!-- start encyption btn -->
        <button type="submit" class="startDecryption">
          Pokreni Enkripciju
        </button>
        <!-- end of start encryptionbtn -->
        <!-- output encoded txt -->
        <div class="displayEncryptedTxt">
          <textarea id="areaDisplayDecTxt" rows="10"></textarea>
        </div>
        <!-- end of output encoded txt-->
        <!-- start encryption -->

        <!-- <input type="button" class="hajde" value="preuzmi" /> -->
        <!-- end of start ecnryption -->
        <!-- download encrypted txt, secret key & iv -->
        <button class="exportDecFile">Preuzmite dekriptovani fajl</button>
      </div>
    </div>
    <script src="encryption.js"></script>
    <script>
      function readFile(input, elementSelector) {
        console.log("selektor: ", elementSelector);

        let file = input.files[0];

        let reader = new FileReader();

        reader.readAsText(file);

        reader.onload = function () {
          console.log(reader.result);
          document.querySelector(elementSelector).value = reader.result;
          document.querySelector(".startEncryption").classList.remove("hide");
        };

        reader.onerror = function () {
          console.log(reader.error);
        };
      }
    </script>
    <script>
      const getTextArea = document.querySelector(".startEncryption");
      function isEmptyOrReset(e) {
        const getTextArea = document.querySelector(".startEncryption");
        if (getTextArea.value) {
          getTextArea.classList.remove("hide");
        } else {
          getTextArea.classList.add("hide");
          console.log("stani");
        }
      }
      function handleTextAreaInput(e) {
        if (e.value) {
          getTextArea.classList.remove("hide");
        } else {
          getTextArea.classList.add("hide");
        }
      }
    </script>
    <script src="toggleCheckBox.js"></script>
    <script src="selectEncDec.js"></script>
    <script src="decryption.js"></script>
  </body>
</html>
